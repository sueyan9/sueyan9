# .github/workflows/update-readme-svgs.yml
name: Update README SVGs
on:
  schedule:
    - cron: "17 3 * * *"   # 每天 03:17 UTC（避开整点）
  workflow_dispatch:

permissions:
  contents: write

env:
  USERNAME: sueyan9

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Fetch cards as static SVGs
        run: |
          set -e
          mkdir -p assets
          fetch() { url="$1"; out="$2"; tmp="$(mktemp)"; 
            echo "Fetching $url"
            if curl -fsSL --max-time 30 "$url" -o "$tmp"; then
              if grep -q "<svg" "$tmp"; then mv "$tmp" "$out"; echo "Saved $out"; else rm -f "$tmp"; fi
            else rm -f "$tmp"; fi
          }
          fetch "https://github-readme-stats.vercel.app/api?username=${USERNAME}&hide_rank=true" "assets/stats.svg"
          fetch "https://streak-stats.demolab.com?user=${USERNAME}" "assets/streak.svg"
      - name: Commit changes if any
        run: |
          if git diff --quiet -- assets; then
            echo "No SVG changes."
          else
            git config user.name "github-actions[bot]"
            git config user.email "41898282+github-actions[bot]@users.noreply.github.com"
            git add assets/*.svg
            git commit -m "chore: refresh README SVGs [skip ci]"
            git push
          fi
